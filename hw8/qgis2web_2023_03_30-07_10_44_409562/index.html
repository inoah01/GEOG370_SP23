<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css"><link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        #map {
            width: 1561px;
            height: 779px;
        }
        </style>
        <title>HW8: Vector Spatial Analysis (ZEV Registration + EV Charging Stations) - Noah Davis - GEOG370 SP23</title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/Dec2022ZEVRegistrations_0.js"></script>
        <script src="data/5MileBufferClippedandDissolved_1.js"></script>
        <script src="data/EVChargingStations_2.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:true, maxZoom:28, minZoom:1
        }).fitBounds([[33.10386276335669,-85.568478555756],[38.03417978493295,-73.50441454013516]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0]
        .innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0]
        .className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        function pop_Dec2022ZEVRegistrations_0(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">County</th>\
                        <td>' + (feature.properties['County'] !== null ? autolinker.link(feature.properties['County'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">EV Registrations</th>\
                        <td>' + (feature.properties['December 2022 NC ZEV Registrations_Electric'] !== null ? autolinker.link(feature.properties['December 2022 NC ZEV Registrations_Electric'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Plug-in Hybrid Registrations</th>\
                        <td>' + (feature.properties['December 2022 NC ZEV Registrations_Plug-In Hybrid*'] !== null ? autolinker.link(feature.properties['December 2022 NC ZEV Registrations_Plug-In Hybrid*'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">EV and Plug-in Hybrid Registrations</th>\
                        <td>' + (feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] !== null ? autolinker.link(feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">EV Charging Station Density (stations/sq mi)</th>\
                        <td>' + (feature.properties['EV Charging Station Density (stations/sq mi)'] !== null ? autolinker.link(feature.properties['EV Charging Station Density (stations/sq mi)'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Number of EV Charging Stations</th>\
                        <td>' + (feature.properties['Count_Number of EV Stations'] !== null ? autolinker.link(feature.properties['Count_Number of EV Stations'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_Dec2022ZEVRegistrations_0_0(feature) {
            if (feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] >= 0.000000 && feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] <= 33.000000 ) {
                return {
                pane: 'pane_Dec2022ZEVRegistrations_0',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,255,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] >= 33.000000 && feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] <= 72.600000 ) {
                return {
                pane: 'pane_Dec2022ZEVRegistrations_0',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(191,224,194,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] >= 72.600000 && feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] <= 152.200000 ) {
                return {
                pane: 'pane_Dec2022ZEVRegistrations_0',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(128,193,133,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] >= 152.200000 && feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] <= 448.000000 ) {
                return {
                pane: 'pane_Dec2022ZEVRegistrations_0',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(64,161,72,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] >= 448.000000 && feature.properties['December 2022 NC ZEV Registrations_Electric and Plug-In Hybrid Total'] <= 13381.000000 ) {
                return {
                pane: 'pane_Dec2022ZEVRegistrations_0',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,130,11,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_Dec2022ZEVRegistrations_0');
        map.getPane('pane_Dec2022ZEVRegistrations_0').style.zIndex = 400;
        map.getPane('pane_Dec2022ZEVRegistrations_0').style['mix-blend-mode'] = 'normal';
        var layer_Dec2022ZEVRegistrations_0 = new L.geoJson(json_Dec2022ZEVRegistrations_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Dec2022ZEVRegistrations_0',
            layerName: 'layer_Dec2022ZEVRegistrations_0',
            pane: 'pane_Dec2022ZEVRegistrations_0',
            onEachFeature: pop_Dec2022ZEVRegistrations_0,
            style: style_Dec2022ZEVRegistrations_0_0,
        });
        bounds_group.addLayer(layer_Dec2022ZEVRegistrations_0);
        map.addLayer(layer_Dec2022ZEVRegistrations_0);
        function pop_5MileBufferClippedandDissolved_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Station Name'] !== null ? autolinker.link(feature.properties['Station Name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Street Address'] !== null ? autolinker.link(feature.properties['Street Address'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['City'] !== null ? autolinker.link(feature.properties['City'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ZIP'] !== null ? autolinker.link(feature.properties['ZIP'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Station Phone'] !== null ? autolinker.link(feature.properties['Station Phone'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Groups With Access Code'] !== null ? autolinker.link(feature.properties['Groups With Access Code'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Latitude'] !== null ? autolinker.link(feature.properties['Latitude'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Longitude'] !== null ? autolinker.link(feature.properties['Longitude'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ID'] !== null ? autolinker.link(feature.properties['ID'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_5MileBufferClippedandDissolved_1_0() {
            return {
                pane: 'pane_5MileBufferClippedandDissolved_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,191,111,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_5MileBufferClippedandDissolved_1');
        map.getPane('pane_5MileBufferClippedandDissolved_1').style.zIndex = 401;
        map.getPane('pane_5MileBufferClippedandDissolved_1').style['mix-blend-mode'] = 'normal';
        var layer_5MileBufferClippedandDissolved_1 = new L.geoJson(json_5MileBufferClippedandDissolved_1, {
            attribution: '',
            interactive: false,
            dataVar: 'json_5MileBufferClippedandDissolved_1',
            layerName: 'layer_5MileBufferClippedandDissolved_1',
            pane: 'pane_5MileBufferClippedandDissolved_1',
            onEachFeature: pop_5MileBufferClippedandDissolved_1,
            style: style_5MileBufferClippedandDissolved_1_0,
        });
        bounds_group.addLayer(layer_5MileBufferClippedandDissolved_1);
        map.addLayer(layer_5MileBufferClippedandDissolved_1);
        function pop_EVChargingStations_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Station Name</th>\
                        <td>' + (feature.properties['Station Name'] !== null ? autolinker.link(feature.properties['Station Name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Street Address</th>\
                        <td>' + (feature.properties['Street Address'] !== null ? autolinker.link(feature.properties['Street Address'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">City</th>\
                        <td>' + (feature.properties['City'] !== null ? autolinker.link(feature.properties['City'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Accessibility</th>\
                        <td>' + (feature.properties['Groups With Access Code'] !== null ? autolinker.link(feature.properties['Groups With Access Code'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Latitude</th>\
                        <td>' + (feature.properties['Latitude'] !== null ? autolinker.link(feature.properties['Latitude'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Longitude</th>\
                        <td>' + (feature.properties['Longitude'] !== null ? autolinker.link(feature.properties['Longitude'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_EVChargingStations_2_0() {
            return {
                pane: 'pane_EVChargingStations_2',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(227,26,28,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_EVChargingStations_2');
        map.getPane('pane_EVChargingStations_2').style.zIndex = 402;
        map.getPane('pane_EVChargingStations_2').style['mix-blend-mode'] = 'normal';
        var layer_EVChargingStations_2 = new L.geoJson(json_EVChargingStations_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_EVChargingStations_2',
            layerName: 'layer_EVChargingStations_2',
            pane: 'pane_EVChargingStations_2',
            onEachFeature: pop_EVChargingStations_2,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_EVChargingStations_2_0(feature));
            },
        });
        bounds_group.addLayer(layer_EVChargingStations_2);
        map.addLayer(layer_EVChargingStations_2);
            var title = new L.Control();
            title.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info');
                this.update();
                return this._div;
            };
            title.update = function () {
                this._div.innerHTML = '<h2>HW8: Vector Spatial Analysis (ZEV Registration + EV Charging Stations) - Noah Davis - GEOG370 SP23</h2>';
            };
            title.addTo(map);
            var abstract = new L.Control({'position':'topright'});
            abstract.onAdd = function (map) {
                this._div = L.DomUtil.create('div',
                'leaflet-control abstract');
                this._div.id = 'abstract'
                    this._div.setAttribute("onmouseenter", "abstract.show()");
                    this._div.setAttribute("onmouseleave", "abstract.hide()");
                    this.hide();
                    return this._div;
                };
                abstract.hide = function () {
                    this._div.classList.remove("abstractUncollapsed");
                    this._div.classList.add("abstract");
                    this._div.innerHTML = 'i'
                }
                abstract.show = function () {
                    this._div.classList.remove("abstract");
                    this._div.classList.add("abstractUncollapsed");
                    this._div.innerHTML = 'This map is meant to build upon the insights derived from my map from Homework 7, which was a choropleth of Zero-Emission Vehicle registrations in North Carolina (as of Dec 2022). The state of NC defines ZEV as those being electric or plug-in hybrids. From the previous homework, it was clear that there was an uneven distribution of ZEV registrations and that the state had not yet reached its goal of 80,000 total registrations by 2025. On the other hand, it was unclear as what could be causing this geographic disproportion.<br /><br />So for this homework, I wanted to dig deeper and explore some factors that might influence ZEV ownership. In particular, I decided to look into Electric Vehicle (EV) charging stations in North Carolina. Some questions that can be answered through this new map are: How does number of EV charging stations vary across counties? Are there counties in NC with a relatively high number of ZEVs but a low number of charging stations? With a quick lookover, it seems that the number EV charging stations vary exactly the same across counties as ZEV registrations, but by looking at the density of EV charging stations, we can see that that the variation is in fact not the same. This is further demonstrated by analyzing total ZEV registration and EV charging stations across counties. For instance, Iredell County had 970 ZEV registered in Dec 2022, with only 20 EV charging stations. Chatham County, which had a comparable 1076 ZEV registrations has about  half as many charging stations at 11. <br /><br />To construct this map, I used data from the US Department of Energy to find the EV charging stations in North Carolina, the NC Department of Transportation for ZEV registrations, and NC OneMap for state/county borders. I applied geoprocessing techniques of buffer, dissolve, and clip in conjunction to the point layer of EV charging stations. I created a 5-mile buffer to help demonstrate the proximity/accessibility of other charging stations in an area. I initially performed this without also performing a dissolve and clip, but I was left with indistinguishable buffers in areas with a high number of EV stations and buffers "overhanging" the outer edge of the map, respectively. So, I deleted my initial buffer and recreated it with a dissolve, and then performed a clip after-the-fact. For the symbology, I decided that a round, yellow, somewhat opaque buffer would contrast well with the green gradient of the base choropleth layer. For that same reason, I decided to make the EV charging stations red, however, I recognize that this may have hurt the contrast between the buffer and the points themselves. <br /><br />The next step for this exploration into North Carolina\'s ZEV plan would be to look at population data as well as income and occupation data. This map looks at gaps in EV charging infrastructure as a potential cause for disproportionate ZEV registration, but there are more factors at play that would influence a person\'s decision to buy a ZEV. For example, somebody living on a modest income and or working in a trade may need a work truck that is powerful, reliable, and won\'t break the bank. There\'s a very limited number of ZEV that would meet these criteria, and there are even fewer that could be had at a reasonable price, used or new.<br /><br />Data used for this project:<br /><a href="https://afdc.energy.gov/stations/#/analyze?region=US-NC&show_map=true&country=US&access=public&access=private&fuel=ELEC&lpg_secondary=true&hy_nonretail=true&ev_levels=all">Link to NC EV Charging Stations Data Source</a><br /><a href="https://www.nconemap.gov/datasets/9728285994804c8b9f20ce58bae45899_0/explore<br />">Link to NC State and County Borders Data Source</a><br /><a href="https://www.ncdot.gov/initiatives-policies/environmental/climate-change/Pages/zev-registration-data.aspx">Link to NC ZEV Registration Data Source</a><br />';
            };
            abstract.addTo(map);
        var baseMaps = {};
        L.control.layers(baseMaps,{'<img src="legend/EVChargingStations_2.png" /> EV Charging Stations': layer_EVChargingStations_2,'<img src="legend/5MileBufferClippedandDissolved_1.png" /> 5 Mile Buffer (Clipped and Dissolved)': layer_5MileBufferClippedandDissolved_1,'Dec 2022 ZEV Registrations<br /><table><tr><td style="text-align: center;"><img src="legend/Dec2022ZEVRegistrations_0_0330.png" /></td><td>0 - 33</td></tr><tr><td style="text-align: center;"><img src="legend/Dec2022ZEVRegistrations_0_33731.png" /></td><td>33 - 73</td></tr><tr><td style="text-align: center;"><img src="legend/Dec2022ZEVRegistrations_0_731522.png" /></td><td>73 - 152</td></tr><tr><td style="text-align: center;"><img src="legend/Dec2022ZEVRegistrations_0_1524483.png" /></td><td>152 - 448</td></tr><tr><td style="text-align: center;"><img src="legend/Dec2022ZEVRegistrations_0_448133814.png" /></td><td>448 - 13381</td></tr></table>': layer_Dec2022ZEVRegistrations_0,},{collapsed:false}).addTo(map);
        setBounds();
        </script>
    </body>
</html>
